{% if message %}
  <div class="fixed alert alert-{% if changed %}ok{% else %}error{% endif %}">
    <button type="button" class="close" data-dismiss="alert">&times;</button>
    {{ message }}
  </div>
{% endif %}

{% trans %}
  <p>You can change your current password using this form. We are suggesting you a new
  password which is agree with our security requirements. You can also set your own
  password but it should be agree with our security requirements.</p>
{% endtrans %}

<div class='password-format'>
{% trans %}
  <p>Your password should agree the follow requirements:</p>
  <ul>
    <li>Must be longer than 12 characters.</li>
    <li>Should use numbers, letters and other symbols.</li>
    <li>Avoid to use known words.</li>
  </ul>
{% endtrans %}
</div>

{{ form|safe }}

<script>

  var init_password_form = function () {
          $("#changePasswordDialog input[name=use_custom_password]").off("click");
          $("#changePasswordDialog input[name=use_custom_password]").click(password_form_toggle);
          password_form_toggle();
      },

      password_form_toggle = function () {
          var container = $("#changePasswordDialog");
          if (container.find("input[name=use_custom_password]").is(":checked")) {
              // Show the custom password input
              container.find("span.suggested-password").parents(".control-group").hide();
              container.find(".custom-password").parents(".control-group").fadeIn();

          }
          else {
              // Empty the custom password field
              // Show the suggested password
              container.find(".custom-password").parents(".control-group").hide().find("input").val("");
              container.find("span.suggested-password").parents(".control-group").fadeIn();
          }
      },

      init_password_dialog = function () {
          var events;
           $("#changePassword").click(function() {
               $('#changePasswordDialog').modal('show');
               init_password_form();
               $('#changePassword').trigger('password-dialog-open');
           });

          events = $._data($('body')[0], 'events')['form-submitted'];
          events = $.map(events, function (o) {
            return o.handler;
          });
          $('body').off('form-submitted');
          $('body').on('form-submitted', function () {
              $('#changePasswordDialog .alert-block').addClass('fixed');
          });

          $.each(events, function (i, o) { 
               $('body').on('form-submitted', o);
          });
      };

  $('body').on('formready', init_password_form);
  $(document).ready(init_password_dialog);



</script>
