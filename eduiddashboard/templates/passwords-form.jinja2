{% extends "templates/baseform.jinja2" %}

{% block form_generic_description %}
   <h4>{% trans %}Security{% endtrans %}</h4>
{% endblock %}

{% block extrajs %}

{{ super() }}

<script>
  $(document).ready(function () {
      var password_form_toggle = function () {
              var container = $("#changePasswordDialog");
              if (container.find("input[name=use_custom_password]").is(":checked")) {
                  // Show the custom password input
                  container.find("span.suggested-password").parents(".control-group").hide();
                  container.find(".custom-password").parents(".control-group").fadeIn();

              }
              else {
                  // Empty the custom password field
                  // Show the suggested password
                  container.find(".custom-password").parents(".control-group").hide().find("input").val("");
                  container.find("span.suggested-password").parents(".control-group").fadeIn();
              }
          }

      $("#changePassword").click(function() {
          $('#changePasswordDialog').modal('show');
          $('#changePassword').trigger('password-dialog-open');
      });

      $('#changePassword').on('password-dialog-open', function () {
          $("#changePasswordDialog input[name=use_custom_password]").unbind("click");
          $("#changePasswordDialog .custom-password").parents(".control-group").hide().find("input").val("");
          $("#changePasswordDialog input[name=use_custom_password]").click(password_form_toggle);
      });
  });
</script>
{% endblock %}


{% block extra_content %}
  <table class='table table-bordered table-thin table-form passwords'>
    <tr>
      <th>{{ _('Credential') }}</th>
      <th>{{ _('Creation date') }}</th>
      <th>{{ _('Last used') }}</th>
    </tr>
    <tr>
      <td class='type'>{{ _('Password') }}</td>
      <td>2013/10/9</td>
      <td>?</td>
    </tr>
  </table>

  <button id="changePassword" name="changepassword" type="submit" class="btn btn-primary " value="{{ _('Change password') }}">{{ _('Change password') }}</button>
{% endblock %}

{% block form_generic_form %}

    <div id="changePasswordDialog" class="modal hide" tabindex="-1" role="dialog" aria-labelledby="windowTitleLabel" aria-hidden="true">
      <div class="modal-header">
        <a href="#" class="close" data-dismiss="modal">Ã—</a>
        <h3 id="askDialogPrompt">
          {{ _('Change password') }}
        </h3>
      </div>
      <div class="modal-body">
        {% if message %}
          <div class="fixed alert alert-{% if changed %}ok{% else %}error{% endif %}">
            <button type="button" class="close" data-dismiss="alert">&times;</button>
            {{ message }}
          </div>
        {% endif %}

        {% trans %}
          <p>You can change your current password with this form. We are suggesting you a new
          password which is agreed with our format requirements. You can also set your own
          password but that should be agreed with our format requirements.</p>
        {% endtrans %}

        <div class='password-format'>
        {% trans %}
          <p>Your password should agree the follow requirements:</p>
          <ul>
            <li>Must be longer than 12 characters.</li>
            <li>Should use numbers, letters and other symbols.</li>
            <li>Avoid to use known words.</li>
          </ul>
        {% endtrans %}
        </div>

        {{ form|safe }}
      </div>
    </div>

{% endblock %}
