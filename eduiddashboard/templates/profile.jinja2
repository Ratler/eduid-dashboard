{% extends "templates/base.jinja2" %}

{% block nav_class_home %}active{% endblock %}

{% block contents %}

  {% if context.workmode == 'personal' %}
  <h3>{{ _("Your profile") }}</h3>
  {% else %}
  <h3>{{ _("Editing %(email)s user", email=user.get('mail')) }}</h3>
  {% endif %}

  {% with loa=request.session.get('loa', 1) %}
    <div class='loa-big'>
      <div>{% trans loa=loa %}level <span class="level">{{ loa }}</span>{% endtrans %}</div>
    </div>
  {% endwith %}

  <div class='clearfix'></div>

  <div class='row'>
    <div class='span6'>
        {% if context.workmode == 'personal' %}
          {% with loa=request.session.get('loa', 1) %}
           <h4>{{ _("Level of assurance") }}</h4>
           <ul class='circles-widget-labels'>
             <li><a href='#' title="{{ _('Level 1') }}" data-toggle='popover'
                   data-content='{{_("On level 1 you can do something")}}'>
                 {{ _('Level 1') }}</a></li>
             {% if max_loa >= 2 %}
             <li><a href='#' title="{{ _('Level 2') }}" data-toggle='popover'
                   data-content='{{ _("On level 2 you can do something")}}'>
                 {{ _('Level 2') }}</a></li>
             {% endif %}{% if max_loa >= 3 %}
             <li><a href='#' title="{{ _('Level 3') }}" data-toggle='popover'
                   data-content='{{ _("On level 3 you can do something")}}'>
                 {{ _('Level 3') }}</a></li>
             {% endif %}{% if max_loa >= 4 %}
             <li><a href='#' title="{{ _('Level 4') }}" data-toggle='popover'
                   data-content='{{_("On level 4 you can do something")}}'>
                 {{ _('Level 4') }}</a></li>
             {% endif %}
           </ul>

           <div class='circles-widget level-{{ loa }} max-level-{{ max_loa }}'>
             <div class='img'></div>
             <div class='bar'></div>
           </div>

           <div class='popover-container'>
           </div>

           <div class='level-assurance-description'>
             {% trans loa=loa %}You are in level <span class="level">{{ loa }}</span>{% endtrans %}
              {% if loa == max_loa %}
                {% trans %}<p>This is the highest level of assurance available for your profile</p>{% endtrans %}
              {% else %}
                {% trans %}<p>If you need to increase this level to get more permissions
                you must login with another authentication method</p>{% endtrans %}
              {% endif %}
           </div>
          {% endwith %}
        {% endif %}

        {% if pending_actions %}
          <h4>{{_("Pending Actions")}}</h4>
          <ul class='unstyled pending-actions'>
          {% for formid, msg in pending_actions %}
            <li><a href='#{{ formid }}'>{{ _(msg) }}</a></li>
          {% endfor %}
          </ul>
        {% endif %}

    </div>

    <div class='span6 profile-filled'>
      <h4>{{ _("Profile filled") }}: <span class="percentaje">{{ profile_filled }}%</span></h4>
      <div class="progress progress-striped">
        <div class="bar" style="width: {{ profile_filled }}%;"></div>
      </div>
    </div>
  </div>

  <div class='clear'></div>

  <div class='profile-combo tabbable tabs-left'>
    <ul class='nav nav-tabs'>
      {% for tab in tabs %}
        <li>
          {% with status = tab.status %}
            {% if status and 'icon' in status %}
              <a href='#{{tab.id}}'
                 data-toggle='tooltip'
                 title='{{_(status.pending_actions)}}'>
                    <i class='{{status.icon}}'></i>
                {{_(tab.label)}}
              </a>
            {% else %}
              <a href='#{{tab.id}}'>{{_(tab.label)}}</a>
            {% endif %}
          {% endwith %}
        </li>
      {% endfor %}
    </ul>

    <div class='tab-content info-container'>
      <div class='tab-pane active'></div>
    </div>
  </div>


{% endblock %}


{% block extracss %}
    <link href="{{'deform:static/css/ui-lightness/jquery-ui-1.8.11.custom.css'|static_url}}" rel="stylesheet" media="screen">
{% endblock %}


{% block extrajs %}

<script src="{{'deform:static/scripts/jquery-ui-1.8.11.custom.min.js'|static_url}}"></script>
<script src="{{'deform:static/scripts/jquery.maskedinput-1.2.2.min.js'|static_url}}"></script>
<script src="{{'deform:static/scripts/jquery.form-3.09.js'|static_url}}"></script>

<script src="{{'deform:static/scripts/deform.js'|static_url}}"></script>
<script src="{{'deform_bootstrap:static/deform_bootstrap.js'|static_url}}"></script>

<script src="{{'eduiddashboard:static/js/tabbed-form.js'|static_url}}"></script>
<script src="{{'eduiddashboard:static/js/proofing.js'|static_url}}"></script>

<script src="{{'eduiddashboard:static/js/tablelist-form.js'|static_url}}"></script>

<script id='communication-error-template' language='text/template'>
  <div class='alert communication-error'>
    <button type="button" class="close" data-dismiss="alert">&times;</button>
    <strong>{{_('Warning!')}}</strong> {{_('Something goes wrong. Please, try it later.')}}
  </div>
</script>

<script id='communication-error-permissions-template' language='text/template'>
  <div class='alert communication-error-permissions'>
    <button type="button" class="close" data-dismiss="alert">&times;</button>
    <strong>{{_('Error!')}}</strong> {{_("You haven't permissions to access that resource.")}}
  </div>
</script>

<script>

var loa_popovers = function () {
  $('.circles-widget-labels a').popover({
    placement: 'bottom',
    trigger: 'hover',
    delay: {
      show: 250,
      hide: 500
    }
  });

  $('.circles-widget-labels a').click(function (e) {
      e.preventDefault();
  });
};

$(document).ready(function () {
    $("a[data-toggle=tooltip]").tooltip();
    $("button[data-toggle=tooltip]").tooltip();
    loa_popovers();

    function showStatus() {
      userstatus.renderStatus('{{ context.safe_route_url('userstatus') }}');
    }

    {% if context.workmode == 'personal' %}
      $('body').on('form-submitted action-executed', function() {
        showStatus();
      });
    {% else %}
      function statusPolling() {
        showStatus();
        window.setTimeout(statusPolling, {{ polling_timeout_for_admin }});
      }
      statusPolling();
    {% endif %}

    $('body').on('communication-error', function(){
      var message = $('#communication-error-template').text();
      $('.container div.messages').append(message);
      window.setTimeout(function () {
        $('.communication-error').fadeOut();
      }, 5*1000);
    });

    $('body').on('communication-error-permissions', function(){
      var message = $('#communication-error-permissions-template').text();
      $('.container div.messages').append(message);
      window.setTimeout(function () {
        $('.communication-error-permissions').fadeOut();
      }, 5*1000);
    });
});

</script>

{% endblock %}
